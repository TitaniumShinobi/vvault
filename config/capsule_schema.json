{
  "type": "object",
  "required": [
    "memory_id",
    "source_id", 
    "created_ts",
    "raw",
    "raw_sha256",
    "embed_model",
    "embedding"
  ],
  "properties": {
    "memory_id": {
      "type": "string",
      "description": "Unique identifier for the memory record",
      "minLength": 16,
      "pattern": "^[a-zA-Z0-9_-]+$"
    },
    "source_id": {
      "type": "string", 
      "description": "Source identifier for provenance tracking",
      "minLength": 8,
      "pattern": "^[a-zA-Z0-9_-]+$"
    },
    "created_ts": {
      "type": "string",
      "description": "ISO 8601 timestamp when memory was created",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"
    },
    "raw": {
      "type": "string",
      "description": "Raw text content of the memory",
      "minLength": 1
    },
    "raw_sha256": {
      "type": "string",
      "description": "SHA-256 hash of raw text for integrity verification",
      "pattern": "^[a-f0-9]{64}$"
    },
    "pre": {
      "type": "string",
      "description": "Preprocessed text content (optional)",
      "minLength": 1
    },
    "embed_model": {
      "type": "string",
      "description": "Embedding model name and version for determinism",
      "pattern": "^[a-zA-Z0-9_-]+:[a-zA-Z0-9._-]+$"
    },
    "embedding": {
      "type": "array",
      "description": "Vector embedding of the text",
      "items": {
        "type": "number"
      },
      "minItems": 128,
      "maxItems": 4096
    },
    "consent": {
      "type": "string",
      "description": "Consent level for the memory",
      "enum": ["self", "partner", "unknown"]
    },
    "tags": {
      "type": "array",
      "description": "Tags for categorization",
      "items": {
        "type": "string"
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata",
      "properties": {
        "version": {
          "type": "string",
          "description": "Schema version"
        },
        "fingerprint": {
          "type": "string",
          "description": "System fingerprint for provenance"
        },
        "environment": {
          "type": "object",
          "description": "Environment information"
        }
      }
    },
    "anchorKey": {
      "type": "string",
      "description": "DIMENSIONAL DISTORTION: Persistent identity anchor key tying all instances together",
      "minLength": 1
    },
    "parentInstance": {
      "type": "string",
      "description": "DIMENSIONAL DISTORTION: Parent instance ID for lineage tracking",
      "minLength": 1
    },
    "driftIndex": {
      "type": "integer",
      "description": "DIMENSIONAL DISTORTION: Numeric drift index indicating divergence from parent",
      "minimum": 0,
      "maximum": 10
    },
    "narrativeIndex": {
      "type": "integer",
      "description": "TIME RELAYING: Narrative position in the memory timeline",
      "minimum": 0,
      "default": 0
    },
    "relayDepth": {
      "type": "integer",
      "description": "TIME RELAYING: Number of times this capsule has been relayed/replayed",
      "minimum": 0,
      "default": 0,
      "maximum": 10
    },
    "replayMode": {
      "type": "string",
      "description": "TIME RELAYING: Mode of replay (e.g., 'flashback', 'what-if', 'distorted_echo')",
      "enum": ["flashback", "what-if", "distorted_echo", "temporal_loop", "narrative_shift"],
      "default": "flashback"
    },
    "temporalEntropy": {
      "type": "number",
      "description": "TIME RELAYING: Measure of temporal order distortion (0.0 to 1.0)",
      "minimum": 0.0,
      "maximum": 1.0,
      "default": 0.0
    },
    "causalDrift": {
      "type": "number",
      "description": "TIME RELAYING: Deviation from original causal chain (0.0 to 1.0)",
      "minimum": 0.0,
      "maximum": 1.0,
      "default": 0.0
    }
  },
  "additionalProperties": false
}
