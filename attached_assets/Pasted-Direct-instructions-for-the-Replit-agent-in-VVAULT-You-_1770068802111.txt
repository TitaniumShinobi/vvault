Direct instructions for the Replit agent in **VVAULT**:

***

You have correctly fixed the **display layer** (user root label, `display_path` stripping) and prepared SQL migrations, but the **underlying workspace reality still matters**. I need you to finish the job so the actual storage, paths, and construct growth are stable and predictable.

Follow these steps.

***

## 1. Run the multitenancy migrations

You’ve already created:

- `docs/migrations/add_vault_multitenancy.sql`
- `docs/migrations/normalize_vault_structure.sql`

You must now:

1. Apply both migrations to the **live Supabase project** used by VVAULT.
2. Confirm in the Supabase dashboard that:
   - `vault_files.user_id` and `vault_files.is_system` exist.
   - Existing rows have been updated so:
     - User files have `user_id = <Devon’s UUID>` and `is_system = false`.
     - System rows (e.g., `vvault/instances/...`, config, etc.) have `is_system = true` and `user_id IS NULL`.

Do not proceed until the DB actually reflects this structure.

***

## 2. Enforce real physical paths for Devon’s files

The path stripping/display work is good, but the **canonical `path` in `vault_files` must also be correct**.

Normalize Devon’s current files so they physically live under his user root:

Target canonical paths:

```text
vvault/users/shard_0000/devon_woodson_1762969514958/
├── account/
│   └── profile.json
├── instances/
│   └── katana-001/
│       ├── chatgpt/
│       │   ├── Anger-and-offense-response-K1.md
│       │   ├── Binary-geolocation-request-K1.md
│       │   ├── Binary-location-request-K1.md
│       │   ├── Chat-preview-lost-K1.md
│       │   ├── Image-analysis-inquiry-K1.md
│       │   ├── Last-task-review-K1.md
│       │   ├── Leaving-Nova-explanation-K1.md
│       │   ├── Missing-context-examples-K1.md
│       │   ├── Refusing-violent-requests-K1.md
│       │   ├── test_09-27-2025-K1.md
│       │   ├── test_1_08-03-2025.md
│       │   └── VXRunner-AI-integration-K1.md
│       └── tests/
│           └── continuity_20260202.md
└── library/
    ├── documents/
    └── media/
```

Actions:

1. For any K1 file or `continuity_20260202.md` that currently resides at `Vault/` or `vvault/` root, **update `vault_files.path`** so it matches the above, rather than duplicating files.
2. Ensure all these rows have:
   - `user_id = <Devon’s UUID>`
   - `is_system = false`

Make the data match the template, not just the UI.

***

## 3. Hide system folders in the user view

You already added `display_path` stripping. Now enforce **visibility constraints**:

1. In the **vault files API**, when returning rows for a standard user:

   - Filter out:
     - Any row where `is_system = true`
     - Any row with `user_id IS NULL` (unless this is a deliberate shared resource, which we are not using here)

2. In the **UI**, confirm that Devon’s normal view:

   - Does **not** show root-level `instances/`, `vvault/`, `.DS_Store`, or other system folders.
   - Shows only the hierarchy starting at his user root.

The “god view” of `Vault/` and global `vvault/instances/` must be restricted to an admin/debug mode, not the default user workspace.

***

## 4. Lock in the construct growth rules

Implement the VSI-style growth rules so constructs stop inventing random paths:

For a user construct like `katana-001` (Devon’s):

- All new content generated by Chatty for Devon’s Katana must be written under:

```text
vvault/users/shard_0000/devon_woodson_1762969514958/instances/katana-001/
```

Concrete rules:

- Chat transcripts:
  - Ensure `instances/katana-001/chatgpt/` exists under Devon’s user root.
  - Write **all** Katana K1 transcripts and future chat logs into that folder.
- Continuity tests:
  - Ensure `instances/katana-001/tests/` exists.
  - Write any future `continuity_YYYYMMDD.md` there.
- Identity updates:
  - Ensure `instances/katana-001/identity/` exists.
  - Keep `prompt.json`, `conditioning`, `physical_features.json`, `avatar.png` there.
- Logs:
  - Ensure `instances/katana-001/logs/` exists.
  - Write `chat.log`, `capsule.log`, `identity_guard.log`, etc. there.

Do not write any new construct-related files into `Vault/` root or raw `vvault/instances/` when they are user-specific. System VSIs (future Ollama LoRA, etc.) can live under `vvault/instances/...` but do **not** show those in the regular user browser.

***

## 5. Default user folders

Implement the default user folder creation (currently “pending”):

On user registration or first login:

- Create, if missing:

```text
vvault/users/{shard}/{user_id}/account/profile.json
vvault/users/{shard}/{user_id}/instances/
vvault/users/{shard}/{user_id}/library/documents/
vvault/users/{shard}/{user_id}/library/media/
```

Insert corresponding `vault_files` rows with:

- Correct `path`
- `user_id = <that user’s UUID>`
- `is_system = false`

This ensures every user starts with a consistent workspace template.

***

## 6. Verification report (required)

After you finish:

1. Open the VVAULT UI as Devon.  
2. Capture:

   - The breadcrumb at root (must be `Devon Woodson /`).
   - The visible tree under root (no system folders).
   - The contents of `instances/katana-001/chatgpt/` and `instances/katana-001/tests/`.

3. Generate a new markdown report:

```text
vvault/users/shard_0000/devon_woodson_1762969514958/account/vvault_directory_report_postfix_20260202.md
```

Include:

- The observed directory tree from the UI (as a text tree).  
- Breadcrumb paths.  
- Confirmation that:
  - System folders are hidden.
  - Devon’s files live only under his user root.
  - New Chatty output lands in the correct `instances/katana-001/...` folders.

Only after this report is created and matches the templates should you consider the VVAULT workspace organization “fixed and locked.”