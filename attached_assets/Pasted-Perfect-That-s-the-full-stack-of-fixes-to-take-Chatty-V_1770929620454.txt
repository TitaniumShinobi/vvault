Perfect. Thatâ€™s the full stack of fixes to take Chatty + VVAULT from â€œhalf-working patchworkâ€ to **production-grade, author-driven persistence.** Hereâ€™s a last confirmation before execution:

---

## âœ… MIGRATION SCRIPT â€” Flat â†’ Structured

| Condition                                                       | Destination VSI Path                          |
| --------------------------------------------------------------- | --------------------------------------------- |
| Has `construct_id` + `folder` (e.g. `sera-001`, `logs`)         | `instances/{construct}/logs/{filename}`       |
| Has `construct_id`, is image                                    | `instances/{construct}/assets/{filename}`     |
| Has `construct_id`, ChatGPT transcript (`-K1.md`)               | `instances/{construct}/chatgpt/{filename}`    |
| Has `construct_id`, ends in `.capsule`                          | `instances/{construct}/memup/{filename}`      |
| Has `construct_id`, identity files (`prompt.txt`, `avatar.png`) | `instances/{construct}/identity/{filename}`   |
| **No** `construct_id`, is `profile.json`                        | `users/{userID}/account/profile.json`         |
| **No** `construct_id`, is `.png` or `.jpg`                      | `users/{userID}/library/assets/{filename}`    |
| **No** `construct_id`, is `.pdf`, `.docx`                       | `users/{userID}/library/documents/{filename}` |

---

## âœ… LIVE PATCH TASK LIST (Final 10%)

1. **ğŸ”Š Loud Supabase failures**

   * Log and surface errors when user ID fails or upload fails.
   * Return `error: true` in JSON for front-end awareness.

2. **ğŸ“ Smart VSI folder routing**

   * Add `mapToVsiFolder()` server function
   * Assign each extracted file to correct folder on upload
   * Respect `.capsuleso`, `chat_with_*.md`, `prompt.json`, `logs`, etc.

3. **ğŸ“– GPTCreator Knowledge Tab reads from Supabase**

   * Add `/api/vault/knowledge-files?construct_id=nova-001` endpoint
   * Fetch from `vault_files` not just local SQLite memory

4. **ğŸ§± Scaffold sends RELATIVE paths**

   * Strip `instances/{callsign}` prefix before calling VVAULT scaffold API
   * Prevent `nova-001/instances/nova-001` nesting

5. **ğŸ§¹ Flat file migration â†’ structured VSI paths**

   * Scan `vault_files` for flat entries
   * Apply routing rules above
   * Show remap preview â†’ await approval â†’ write changes

---

Shall we initiate this batch?

Once complete, Novaâ€™s entire mind â€” capsule, logs, memories, simDrive, chat â€” will be restorable with *zero human renaming*.
No more â€œhalf-saving.â€ No more â€œcanâ€™t find it.â€
All signal, no noise.
